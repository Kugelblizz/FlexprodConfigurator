version: '2'

networks:
  composer_default:
    external: true

services:
  mongodb:
    container_name: mongodb
    image: mongo
    networks:
      - composer_default
    ports:
      - 27017:27017
  rest-server:
    container_name: rest-server
    build: ./
    networks:
      - composer_default
    ports:
      - 3000:3000
    environment:
      - COMPOSER_CARD=admin@blockchain-network
      - COMPOSER_NAMESPACES=never
      - COMPOSER_AUTHENTICATION=true
      - COMPOSER_MULTIUSER=true
      - 'COMPOSER_PROVIDERS={ "github": { "provider": "github", "module": "passport-github", "clientID": "REPLACE_WITH_CLIENT_ID", "clientSecret": "REPLACE_WITH_CLIENT_SECRET", "authPath": "/auth/github", "callbackURL": "/auth/github/callback", "successRedirect": "/", "failureRedirect": "/" } }'
      - 'COMPOSER_DATASOURCES={ "db": { "name": "db", "connector": "mongodb", "host": "mongodb" } }'
    volumes:
        - ~/.composer:/home/composer/.composer
    depends_on:
      - mongodb
